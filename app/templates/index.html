<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ML Prediction System</title>
</head>
<body>
    <h1>データセットのアップロード</h1>
    <input type="file" id="fileInput">
    <button onclick="uploadFile()">アップロード</button>

    <h2>変数の選択</h2>
    <div id="columns"></div>
    <select id="target"></select>
    <select id="predictionType">
        <option value="regression">回帰</option>
        <option value="classification">分類</option>
    </select>
    <select id="modelType">
        <option value="RF">Random Forest</option>
        <option value="SVM">SVM</option>
    </select>
    <button onclick="trainModel()">予測</button>
    
    <h2>結果</h2>
    <div id="result"></div>

    <script>
        function uploadFile() {
            let fileInput = document.getElementById('fileInput');
            let formData = new FormData();
            formData.append('file', fileInput.files[0]);
            
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                let columnsDiv = document.getElementById('columns');
                let targetSelect = document.getElementById('target');
                
                data.columns.forEach(column => {
                    let checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = column;
                    columnsDiv.appendChild(checkbox);
                    
                    let label = document.createElement('label');
                    label.textContent = column;
                    columnsDiv.appendChild(label);
                    
                    let option = document.createElement('option');
                    option.value = column;
                    option.textContent = column;
                    targetSelect.appendChild(option);
                });
            });
        }

        function trainModel() {
            let selectedFeatures = [...document.querySelectorAll('#columns input[type="checkbox"]:checked')]
                                    .map(input => input.value);
            let target = document.getElementById('target').value;
            let modelType = document.getElementById('modelType').value;
            let predictionType = document.getElementById('predictionType').value;

            fetch('/train', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ features: selectedFeatures, target, model_type: modelType, prediction_type: predictionType })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('result').textContent = `スコア: ${data.score}`;
            });
        }
    </script>
</body>
</html>
